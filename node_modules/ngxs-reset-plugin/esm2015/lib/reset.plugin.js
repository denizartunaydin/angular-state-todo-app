/**
 * @fileoverview added by tsickle
 * Generated from: lib/reset.plugin.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { getActionTypeFromInstance, getValue, setValue } from '@ngxs/store';
import { ResetService } from './reset.service';
import { getMetaData, StateClear, StateOverwrite, StateReset, StateResetAll, } from './symbols';
import * as ɵngcc0 from '@angular/core';
export class NgxsResetPlugin {
    /**
     * @param {?} resetService
     */
    constructor(resetService) {
        this.resetService = resetService;
    }
    /**
     * @private
     * @param {?} state
     * @param {?} statesToKeep
     * @return {?}
     */
    clearStates(state, statesToKeep) {
        return statesToKeep
            .map((/**
         * @param {?} meta
         * @return {?}
         */
        meta => getPath(meta)))
            .map((/**
         * @param {?} path
         * @return {?}
         */
        path => ({
            parts: path.split('.'),
            value: getValue(state, path),
        })))
            .reduce((/**
         * @param {?} obj
         * @param {?} __1
         * @return {?}
         */
        (obj, { parts, value }) => parts.reduceRight((/**
         * @param {?} acc
         * @param {?} part
         * @return {?}
         */
        (acc, part) => part in obj
            ? {
                [part]: Object.assign(Object.assign({}, obj[part]), acc),
            }
            : { [part]: acc }), value)), (/** @type {?} */ ({})));
    }
    /**
     * @private
     * @param {?} state
     * @param {?} statesToOverwrite
     * @param {?} values
     * @return {?}
     */
    overwriteStates(state, statesToOverwrite, values) {
        statesToOverwrite.forEach((/**
         * @param {?} meta
         * @param {?} index
         * @return {?}
         */
        (meta, index) => (state = setValue(state, getPath(meta), values[index]))));
        return state;
    }
    /**
     * @private
     * @param {?} state
     * @param {?} statesToReset
     * @return {?}
     */
    resetStates(state, statesToReset) {
        statesToReset.forEach((/**
         * @param {?} meta
         * @return {?}
         */
        meta => {
            state = setValue(state, getPath(meta), typeof meta.defaults === 'undefined' ? {} : meta.defaults);
            if (meta.children) {
                state = this.resetStates(state, (/** @type {?} */ (meta.children.map(getMetaData))));
            }
        }));
        return state;
    }
    /**
     * @private
     * @param {?} state
     * @param {?} statesToKeep
     * @return {?}
     */
    resetStatesAll(state, statesToKeep) {
        /** @type {?} */
        const values = statesToKeep.map((/**
         * @param {?} meta
         * @return {?}
         */
        meta => getValue(state, getPath(meta))));
        return this.overwriteStates(this.resetService.initialState, statesToKeep, values);
    }
    /**
     * @param {?} state
     * @param {?} action
     * @param {?} next
     * @return {?}
     */
    handle(state, action, next) {
        /** @type {?} */
        const type = getActionTypeFromInstance(action);
        switch (type) {
            case StateClear.type:
                state = this.clearStates(state, ((/** @type {?} */ (action))).statesToKeep);
                break;
            case StateReset.type:
                state = this.resetStates(state, ((/** @type {?} */ (action))).statesToReset);
                break;
            case StateResetAll.type:
                state = this.resetStatesAll(state, ((/** @type {?} */ (action))).statesToKeep);
                break;
            case StateOverwrite.type:
                const { statesToOverwrite, values } = (/** @type {?} */ (action));
                state = this.overwriteStates(state, statesToOverwrite, values);
                break;
            default:
                break;
        }
        return next(state, action);
    }
}
NgxsResetPlugin.ɵfac = function NgxsResetPlugin_Factory(t) { return new (t || NgxsResetPlugin)(ɵngcc0.ɵɵinject(ResetService)); };
NgxsResetPlugin.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NgxsResetPlugin, factory: NgxsResetPlugin.ɵfac });
/** @nocollapse */
NgxsResetPlugin.ctorParameters = () => [
    { type: ResetService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxsResetPlugin, [{
        type: Injectable
    }], function () { return [{ type: ResetService }]; }, null); })();
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgxsResetPlugin.prototype.resetService;
}
/**
 * @param {?} meta
 * @return {?}
 */
function getPath(meta) {
    return meta.path;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzZXQucGx1Z2luLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL3Jlc2V0LnBsdWdpbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLHlCQUF5QixFQUFFLFFBQVEsRUFBYyxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFeEYsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFDTCxXQUFXLEVBQ1gsVUFBVSxFQUNWLGNBQWMsRUFDZCxVQUFVLEVBQ1YsYUFBYSxHQUNkLE1BQU0sV0FBVyxDQUFDOztBQUduQixNQUFNLE9BQU8sZUFBZTtBQUFHO0FBQVE7QUFDdEI7QUFBUSxJQUF2QixZQUE2QixZQUEwQjtBQUFJLFFBQTlCLGlCQUFZLEdBQVosWUFBWSxDQUFjO0FBQUMsSUFBRSxDQUFDO0FBQzdEO0FBQ087QUFBZ0I7QUFBd0I7QUFDekM7QUFDTDtBQUFRLElBRkMsV0FBVyxDQUFDLEtBQVUsRUFBRSxZQUE2QjtBQUFJLFFBQy9ELE9BQU8sWUFBWTtBQUN2QixhQUFPLEdBQUc7QUFBTTtBQUNQO0FBQ0M7QUFBWSxRQUZYLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFDO0FBQ2pDLGFBQU8sR0FBRztBQUFNO0FBQ0s7QUFDVDtBQUFZLFFBRmIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3BCLFlBQVEsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO0FBQzlCLFlBQVEsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDO0FBQ3BDLFNBQU8sQ0FBQyxFQUFDO0FBQ1QsYUFBTyxNQUFNO0FBQ1Q7QUFBMEI7QUFDVDtBQUNOO0FBQ2YsUUFIUSxDQUFDLEdBQUcsRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLEVB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QUFDZCxZQUNNLEtBQUssVUFBVSxDQUFDLElBQUk7QUFDMUIsZ0JBQVEsS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLENBQUMsbUJBQUEsTUFBTSxFQUFjLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUM5RSxnQkFBUSxNQUFNO0FBQ2QsWUFDTSxLQUFLLGFBQWEsQ0FBQyxJQUFJO0FBQzdCLGdCQUFRLEtBQUssR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDLG1CQUFBLE1BQU0sRUFBaUIsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ25GLGdCQUFRLE1BQU07QUFDZCxZQUNNLEtBQUssY0FBYyxDQUFDLElBQUk7QUFDOUIsc0JBQWMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsR0FBRyxtQkFBQSxNQUFNLEVBQWtCO0FBQ3RFLGdCQUFRLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxpQkFBaUIsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN2RSxnQkFBUSxNQUFNO0FBQ2QsWUFDTTtBQUNOLGdCQUFRLE1BQU07QUFDZCxTQUFLO0FBQ0wsUUFDSSxPQUFPLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDL0IsSUFBRSxDQUFDO0FBQ0g7MkNBM0ZDLFVBQVU7NkdBQ1Q7QUFBQztBQUFtQjtBQUNaLFlBWEQsWUFBWTtBQUFHOzs7c0VBQUU7QUFBQztBQUFhO0FBQ3hDO0FBQ1E7QUFDQztBQUNOLElBT1csdUNBQTJDO0FBQUM7QUFBRTtBQUUzRDtBQUFtQjtBQUFlO0FBeUZuQyxTQUFTLE9BQU8sQ0FBQyxJQUFtQjtBQUFJLElBQ3RDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQztBQUNuQixDQUFDO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBnZXRBY3Rpb25UeXBlRnJvbUluc3RhbmNlLCBnZXRWYWx1ZSwgTmd4c1BsdWdpbiwgc2V0VmFsdWUgfSBmcm9tICdAbmd4cy9zdG9yZSc7XG5pbXBvcnQgeyBNZXRhRGF0YU1vZGVsIH0gZnJvbSAnLi9pbnRlcm5hbHMnO1xuaW1wb3J0IHsgUmVzZXRTZXJ2aWNlIH0gZnJvbSAnLi9yZXNldC5zZXJ2aWNlJztcbmltcG9ydCB7XG4gIGdldE1ldGFEYXRhLFxuICBTdGF0ZUNsZWFyLFxuICBTdGF0ZU92ZXJ3cml0ZSxcbiAgU3RhdGVSZXNldCxcbiAgU3RhdGVSZXNldEFsbCxcbn0gZnJvbSAnLi9zeW1ib2xzJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE5neHNSZXNldFBsdWdpbiBpbXBsZW1lbnRzIE5neHNQbHVnaW4ge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHJlc2V0U2VydmljZTogUmVzZXRTZXJ2aWNlKSB7fVxuXG4gIHByaXZhdGUgY2xlYXJTdGF0ZXMoc3RhdGU6IGFueSwgc3RhdGVzVG9LZWVwOiBNZXRhRGF0YU1vZGVsW10pOiBhbnkge1xuICAgIHJldHVybiBzdGF0ZXNUb0tlZXBcbiAgICAgIC5tYXAobWV0YSA9PiBnZXRQYXRoKG1ldGEpKVxuICAgICAgLm1hcChwYXRoID0+ICh7XG4gICAgICAgIHBhcnRzOiBwYXRoLnNwbGl0KCcuJyksXG4gICAgICAgIHZhbHVlOiBnZXRWYWx1ZShzdGF0ZSwgcGF0aCksXG4gICAgICB9KSlcbiAgICAgIC5yZWR1Y2UoXG4gICAgICAgIChvYmosIHsgcGFydHMsIHZhbHVlIH0pID0+XG4gICAgICAgICAgcGFydHMucmVkdWNlUmlnaHQoXG4gICAgICAgICAgICAoYWNjLCBwYXJ0KSA9PlxuICAgICAgICAgICAgICBwYXJ0IGluIG9ialxuICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICBbcGFydF06IHtcbiAgICAgICAgICAgICAgICAgICAgICAuLi5vYmpbcGFydF0sXG4gICAgICAgICAgICAgICAgICAgICAgLi4uYWNjLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIDogeyBbcGFydF06IGFjYyB9LFxuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgKSxcbiAgICAgICAge30gYXMgYW55LFxuICAgICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgb3ZlcndyaXRlU3RhdGVzKFxuICAgIHN0YXRlOiBhbnksXG4gICAgc3RhdGVzVG9PdmVyd3JpdGU6IE1ldGFEYXRhTW9kZWxbXSxcbiAgICB2YWx1ZXM6IGFueVtdLFxuICApOiBhbnkge1xuICAgIHN0YXRlc1RvT3ZlcndyaXRlLmZvckVhY2goXG4gICAgICAobWV0YSwgaW5kZXgpID0+IChzdGF0ZSA9IHNldFZhbHVlKHN0YXRlLCBnZXRQYXRoKG1ldGEpLCB2YWx1ZXNbaW5kZXhdKSksXG4gICAgKTtcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cblxuICBwcml2YXRlIHJlc2V0U3RhdGVzKHN0YXRlOiBhbnksIHN0YXRlc1RvUmVzZXQ6IE1ldGFEYXRhTW9kZWxbXSk6IGFueSB7XG4gICAgc3RhdGVzVG9SZXNldC5mb3JFYWNoKG1ldGEgPT4ge1xuICAgICAgc3RhdGUgPSBzZXRWYWx1ZShcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIGdldFBhdGgobWV0YSksXG4gICAgICAgIHR5cGVvZiBtZXRhLmRlZmF1bHRzID09PSAndW5kZWZpbmVkJyA/IHt9IDogbWV0YS5kZWZhdWx0cyxcbiAgICAgICk7XG5cbiAgICAgIGlmIChtZXRhLmNoaWxkcmVuKSB7XG4gICAgICAgIHN0YXRlID0gdGhpcy5yZXNldFN0YXRlcyhzdGF0ZSwgbWV0YS5jaGlsZHJlbi5tYXAoXG4gICAgICAgICAgZ2V0TWV0YURhdGEsXG4gICAgICAgICkgYXMgTWV0YURhdGFNb2RlbFtdKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzZXRTdGF0ZXNBbGwoc3RhdGU6IGFueSwgc3RhdGVzVG9LZWVwOiBNZXRhRGF0YU1vZGVsW10pOiBhbnkge1xuICAgIGNvbnN0IHZhbHVlcyA9IHN0YXRlc1RvS2VlcC5tYXAobWV0YSA9PiBnZXRWYWx1ZShzdGF0ZSwgZ2V0UGF0aChtZXRhKSkpO1xuXG4gICAgcmV0dXJuIHRoaXMub3ZlcndyaXRlU3RhdGVzKHRoaXMucmVzZXRTZXJ2aWNlLmluaXRpYWxTdGF0ZSwgc3RhdGVzVG9LZWVwLCB2YWx1ZXMpO1xuICB9XG5cbiAgaGFuZGxlKHN0YXRlOiBhbnksIGFjdGlvbjogYW55LCBuZXh0OiBhbnkpIHtcbiAgICBjb25zdCB0eXBlID0gZ2V0QWN0aW9uVHlwZUZyb21JbnN0YW5jZShhY3Rpb24pO1xuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFN0YXRlQ2xlYXIudHlwZTpcbiAgICAgICAgc3RhdGUgPSB0aGlzLmNsZWFyU3RhdGVzKHN0YXRlLCAoYWN0aW9uIGFzIFN0YXRlQ2xlYXIpLnN0YXRlc1RvS2VlcCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFN0YXRlUmVzZXQudHlwZTpcbiAgICAgICAgc3RhdGUgPSB0aGlzLnJlc2V0U3RhdGVzKHN0YXRlLCAoYWN0aW9uIGFzIFN0YXRlUmVzZXQpLnN0YXRlc1RvUmVzZXQpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBTdGF0ZVJlc2V0QWxsLnR5cGU6XG4gICAgICAgIHN0YXRlID0gdGhpcy5yZXNldFN0YXRlc0FsbChzdGF0ZSwgKGFjdGlvbiBhcyBTdGF0ZVJlc2V0QWxsKS5zdGF0ZXNUb0tlZXApO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBTdGF0ZU92ZXJ3cml0ZS50eXBlOlxuICAgICAgICBjb25zdCB7IHN0YXRlc1RvT3ZlcndyaXRlLCB2YWx1ZXMgfSA9IGFjdGlvbiBhcyBTdGF0ZU92ZXJ3cml0ZTtcbiAgICAgICAgc3RhdGUgPSB0aGlzLm92ZXJ3cml0ZVN0YXRlcyhzdGF0ZSwgc3RhdGVzVG9PdmVyd3JpdGUsIHZhbHVlcyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gbmV4dChzdGF0ZSwgYWN0aW9uKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRQYXRoKG1ldGE6IE1ldGFEYXRhTW9kZWwpOiBzdHJpbmcge1xuICByZXR1cm4gbWV0YS5wYXRoO1xufVxuIl19